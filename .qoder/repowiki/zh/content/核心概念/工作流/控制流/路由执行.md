# è·¯ç”±æ‰§è¡Œ

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [router.py](file://libs/agno/agno/workflow/router.py)
- [workflow_with_router.py](file://cookbook/agent_os/workflow/workflow_with_router.py)
- [early_stop_workflow_with_router.py](file://cookbook/workflows/_06_advanced_concepts/_02_early_stopping/early_stop_workflow_with_router.py)
- [test_router_steps.py](file://libs/agno/tests/integration/workflows/test_router_steps.py)
- [types.py](file://libs/agno/agno/workflow/types.py)
- [workflow.py](file://libs/agno/agno/run/workflow.py)
- [step.py](file://libs/agno/agno/workflow/step.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹

Agnoæ¡†æ¶ä¸­çš„è·¯ç”±æ‰§è¡Œç³»ç»Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠ¨æ€è·¯ç”±æœºåˆ¶ï¼Œå®ƒå…è®¸å·¥ä½œæµæ ¹æ®è¾“å…¥æ•°æ®æˆ–ä¸Šä¸‹æ–‡ä¿¡æ¯æ™ºèƒ½åœ°é€‰æ‹©å’Œæ‰§è¡Œä¸åŒçš„å¤„ç†è·¯å¾„ã€‚è·¯ç”±æ‰§è¡Œçš„æ ¸å¿ƒæ˜¯`Router`ç±»ï¼Œå®ƒæä¾›äº†çµæ´»çš„æ¡ä»¶è·¯ç”±åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å°†æ‰§è¡Œæµå¯¼å‘ä¸åŒçš„æ­¥éª¤ç»„åˆã€‚

è·¯ç”±æ‰§è¡Œçš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š
- **åŠ¨æ€å†³ç­–èƒ½åŠ›**ï¼šæ ¹æ®è¾“å…¥å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„å¤„ç†è·¯å¾„
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç§ç±»å‹çš„æ­¥éª¤ï¼ˆAgentã€Teamã€è‡ªå®šä¹‰å‡½æ•°ç­‰ï¼‰
- **æ—©æœŸç»ˆæ­¢**ï¼šæ”¯æŒåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æå‰ç»ˆæ­¢å·¥ä½œæµæ‰§è¡Œ
- **æµå¼å¤„ç†**ï¼šæä¾›å®Œæ•´çš„å¼‚æ­¥å’Œæµå¼æ‰§è¡Œæ”¯æŒ
- **äº‹ä»¶é©±åŠ¨**ï¼šå®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿæ”¯æŒç›‘æ§å’Œè°ƒè¯•

## é¡¹ç›®ç»“æ„

è·¯ç”±æ‰§è¡ŒåŠŸèƒ½ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹å…³é”®æ–‡ä»¶ä¸­ï¼š

```mermaid
graph TB
subgraph "æ ¸å¿ƒè·¯ç”±æ¨¡å—"
A[router.py] --> B[Routerç±»]
A --> C[è·¯ç”±é€‰æ‹©å™¨]
A --> D[æ­¥éª¤æ‰§è¡Œå™¨]
end
subgraph "ç¤ºä¾‹åº”ç”¨"
E[workflow_with_router.py] --> F[æ™ºèƒ½ç ”ç©¶å·¥ä½œæµ]
G[early_stop_workflow_with_router.py] --> H[å®‰å…¨æ£€æŸ¥å·¥ä½œæµ]
end
subgraph "æµ‹è¯•éªŒè¯"
I[test_router_steps.py] --> J[å•å…ƒæµ‹è¯•]
I --> K[é›†æˆæµ‹è¯•]
end
subgraph "æ”¯æŒç»„ä»¶"
L[types.py] --> M[StepInput/Output]
N[workflow.py] --> O[äº‹ä»¶ç³»ç»Ÿ]
P[step.py] --> Q[åŸºç¡€æ­¥éª¤]
end
B --> F
B --> H
B --> J
B --> K
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L1-L623)
- [workflow_with_router.py](file://cookbook/agent_os/workflow/workflow_with_router.py#L1-L116)
- [early_stop_workflow_with_router.py](file://cookbook/workflows/_06_advanced_concepts/_02_early_stopping/early_stop_workflow_with_router.py#L1-L148)

## æ ¸å¿ƒç»„ä»¶

### Routerç±»è®¾è®¡

`Router`ç±»æ˜¯è·¯ç”±æ‰§è¡Œç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒå®ç°äº†ä»¥ä¸‹å…³é”®åŠŸèƒ½ï¼š

```python
@dataclass
class Router:
    """åŠ¨æ€é€‰æ‹©è¦æ‰§è¡Œçš„æ­¥éª¤çš„è·¯ç”±å™¨"""
    
    # è¿”å›è¦æ‰§è¡Œçš„æ­¥éª¤çš„è·¯ç”±å™¨å‡½æ•°
    selector: Union[
        Callable[[StepInput], Union[WorkflowSteps, List[WorkflowSteps]]],
        Callable[[StepInput], Awaitable[Union[WorkflowSteps, List[WorkflowSteps]]]],
    ]
    choices: WorkflowSteps  # å¯é€‰æ­¥éª¤åˆ—è¡¨
    
    name: Optional[str] = None
    description: Optional[str] = None
```

### æ­¥éª¤ç±»å‹ç³»ç»Ÿ

è·¯ç”±ç³»ç»Ÿæ”¯æŒå¤šç§ç±»å‹çš„æ­¥éª¤ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ¥å£è¿›è¡Œç®¡ç†ï¼š

```mermaid
classDiagram
class Router {
+selector : Callable
+choices : WorkflowSteps
+name : Optional[str]
+description : Optional[str]
+execute(step_input) StepOutput
+execute_stream(step_input) Iterator
+aexecute(step_input) StepOutput
+aexecute_stream(step_input) AsyncIterator
-_route_steps(step_input) List[Step]
-_prepare_steps() void
-_update_step_input_from_outputs() StepInput
}
class Step {
+name : Optional[str]
+agent : Optional[Agent]
+team : Optional[Team]
+executor : Optional[StepExecutor]
+execute(step_input) StepOutput
+execute_stream(step_input) Iterator
}
class Agent {
+name : str
+instructions : str
+tools : List[Tool]
+run(input) RunOutput
}
class Team {
+name : str
+members : List[Agent]
+run(input) TeamRunOutput
}
class WorkflowSteps {
<<union>>
Step
Agent
Team
Loop
Parallel
Condition
Router
}
Router --> WorkflowSteps : "åŒ…å«"
WorkflowSteps --> Step : "å¯ä»¥æ˜¯"
WorkflowSteps --> Agent : "å¯ä»¥æ˜¯"
WorkflowSteps --> Team : "å¯ä»¥æ˜¯"
Step --> Agent : "ä½¿ç”¨"
Step --> Team : "ä½¿ç”¨"
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L25-L40)
- [step.py](file://libs/agno/agno/workflow/step.py#L25-L100)

**ç« èŠ‚æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L25-L40)
- [step.py](file://libs/agno/agno/workflow/step.py#L25-L100)

## æ¶æ„æ¦‚è§ˆ

è·¯ç”±æ‰§è¡Œç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ¶æ„æ¨¡å¼ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼š

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant Router as è·¯ç”±å™¨
participant Selector as é€‰æ‹©å™¨å‡½æ•°
participant Steps as æ­¥éª¤é›†åˆ
participant Executor as æ‰§è¡Œå™¨
Client->>Router : execute(StepInput)
Router->>Router : _prepare_steps()
Router->>Selector : selector(step_input)
Selector-->>Router : è¿”å›æ­¥éª¤åˆ—è¡¨
Router->>Router : _route_steps()
loop å¯¹æ¯ä¸ªé€‰å®šçš„æ­¥éª¤
Router->>Steps : execute(current_step_input)
Steps->>Executor : æ‰§è¡Œæ­¥éª¤
Executor-->>Steps : StepOutput
Steps-->>Router : æ­¥éª¤è¾“å‡º
Router->>Router : _update_step_input_from_outputs()
end
Router-->>Client : æœ€ç»ˆç»“æœ
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L133-L200)
- [router.py](file://libs/agno/agno/workflow/router.py#L234-L300)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### è·¯ç”±é€‰æ‹©å™¨æœºåˆ¶

è·¯ç”±é€‰æ‹©å™¨æ˜¯è·¯ç”±ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒå†³å®šäº†å“ªäº›æ­¥éª¤åº”è¯¥è¢«æ‰§è¡Œï¼š

```python
def _route_steps(self, step_input: StepInput) -> List[Step]:
    """åŸºäºè¾“å…¥è·¯ç”±åˆ°é€‚å½“çš„æ­¥éª¤"""
    if callable(self.selector):
        result = self.selector(step_input)
        
        # æ ¹æ®è¿”å›ç±»å‹å¤„ç†ç»“æœ
        if isinstance(result, Step):
            return [result]
        elif isinstance(result, list):
            return result
        else:
            logger.warning(f"Router function returned unexpected type: {type(result)}")
            return []
    
    return []
```

### æ™ºèƒ½è·¯ç”±ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„æ™ºèƒ½è·¯ç”±å®ç°ï¼š

```python
def research_router(step_input: StepInput) -> List[Step]:
    """åŸºäºè¾“å…¥ä¸»é¢˜æ™ºèƒ½é€‰æ‹©ç ”ç©¶æ–¹æ³•"""
    topic = step_input.previous_step_content or step_input.input or ""
    topic = topic.lower()
    
    # æŠ€æœ¯/åˆ›ä¸šå…³é”®è¯æ£€æµ‹
    tech_keywords = [
        "startup", "programming", "ai", "machine learning",
        "software", "developer", "coding", "tech"
    ]
    
    if any(keyword in topic for keyword in tech_keywords):
        print(f"ğŸ” æŠ€æœ¯ä¸»é¢˜æ£€æµ‹: ä½¿ç”¨HackerNewsç ”ç©¶ '{topic}'")
        return [research_hackernews]
    else:
        print(f"ğŸŒ é€šç”¨ä¸»é¢˜æ£€æµ‹: ä½¿ç”¨ç½‘ç»œç ”ç©¶ '{topic}'")
        return [research_web]
```

### æµå¼æ‰§è¡Œæ”¯æŒ

è·¯ç”±ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„æµå¼æ‰§è¡Œæ”¯æŒï¼ŒåŒ…æ‹¬äº‹ä»¶é©±åŠ¨çš„è¿›åº¦è·Ÿè¸ªï¼š

```mermaid
sequenceDiagram
participant Router as è·¯ç”±å™¨
participant EventSystem as äº‹ä»¶ç³»ç»Ÿ
participant Steps as æ­¥éª¤æ‰§è¡Œå™¨
participant Client as å®¢æˆ·ç«¯
Router->>EventSystem : RouterExecutionStartedEvent
Router->>Router : å¼€å§‹è·¯ç”±é€‰æ‹©
loop æ¯ä¸ªé€‰å®šçš„æ­¥éª¤
Router->>Steps : execute_stream()
Steps->>EventSystem : StepStartedEvent
Steps->>EventSystem : StepOutputEvent
Steps->>EventSystem : StepCompletedEvent
Router->>Router : æ›´æ–°è¾“å…¥çŠ¶æ€
end
Router->>EventSystem : RouterExecutionCompletedEvent
Router-->>Client : æœ€ç»ˆç»“æœ
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L259-L275)
- [router.py](file://libs/agno/agno/workflow/router.py#L510-L520)

### æ—©æœŸç»ˆæ­¢æœºåˆ¶

è·¯ç”±ç³»ç»Ÿæ”¯æŒåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æå‰ç»ˆæ­¢æ•´ä¸ªå·¥ä½œæµï¼š

```python
def content_safety_checker(step_input: StepInput) -> StepOutput:
    """å®‰å…¨æ£€æŸ¥å™¨ï¼Œåœ¨æ£€æµ‹åˆ°ä¸å½“å†…å®¹æ—¶åœæ­¢è·¯ç”±å™¨"""
    content = step_input.previous_step_content or ""
    
    # æ£€æµ‹ä¸å½“å†…å®¹
    if "controversial" in content.lower() or "sensitive" in content.lower():
        return StepOutput(
            step_name="Content Safety Checker",
            content="ğŸš¨ å†…å®¹å®‰å…¨è¿è§„ï¼ç ”ç©¶åŒ…å«äº‰è®®æˆ–æ•æ„Ÿææ–™ã€‚åœæ­¢å·¥ä½œæµä»¥è¿›è¡Œäººå·¥å®¡æŸ¥ã€‚",
            stop=True,  # è¯·æ±‚æå‰ç»ˆæ­¢
        )
    else:
        return StepOutput(
            step_name="Content Safety Checker",
            content="âœ… å†…å®¹å®‰å…¨æ£€æŸ¥é€šè¿‡ã€‚ææ–™é€‚åˆå‘å¸ƒã€‚",
            stop=False,
        )
```

### æ­¥éª¤é“¾å¼æ‰§è¡Œ

è·¯ç”±ç³»ç»Ÿæ”¯æŒæ­¥éª¤é—´çš„é“¾å¼æ‰§è¡Œï¼Œå‰ä¸€ä¸ªæ­¥éª¤çš„è¾“å‡ºä¼šè‡ªåŠ¨ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ­¥éª¤ï¼š

```mermaid
flowchart TD
A[å¼€å§‹è¾“å…¥] --> B[è·¯ç”±é€‰æ‹©å™¨]
B --> C{é€‰æ‹©æ­¥éª¤}
C --> D[æ­¥éª¤1]
D --> E[æ›´æ–°è¾“å…¥çŠ¶æ€]
E --> F{è¿˜æœ‰æ›´å¤šæ­¥éª¤?}
F --> |æ˜¯| G[æ­¥éª¤2]
F --> |å¦| H[å®Œæˆ]
G --> I[æ›´æ–°è¾“å…¥çŠ¶æ€]
I --> F
H --> J[æœ€ç»ˆè¾“å‡º]
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L172-L200)
- [router.py](file://libs/agno/agno/workflow/router.py#L520-L550)

**ç« èŠ‚æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L133-L200)
- [early_stop_workflow_with_router.py](file://cookbook/workflows/_06_advanced_concepts/_02_early_stopping/early_stop_workflow_with_router.py#L30-L80)

### å¼‚æ­¥è·¯ç”±æ‰§è¡Œ

è·¯ç”±ç³»ç»Ÿå®Œå…¨æ”¯æŒå¼‚æ­¥æ‰§è¡Œï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ï¼š

```python
async def aexecute(
    self,
    step_input: StepInput,
    session_id: Optional[str] = None,
    user_id: Optional[str] = None,
    workflow_run_response: Optional[WorkflowRunOutput] = None,
    session_state: Optional[Dict[str, Any]] = None,
    store_executor_outputs: bool = True,
) -> StepOutput:
    """å¼‚æ­¥æ‰§è¡Œè·¯ç”±å™¨åŠå…¶é€‰å®šçš„æ­¥éª¤"""
    # å¼‚æ­¥è·¯ç”±é€‰æ‹©
    steps_to_execute = await self._aroute_steps(step_input)
    
    # é¡ºåºæ‰§è¡Œæ­¥éª¤
    for step in steps_to_execute:
        step_output = await step.aexecute(...)
        # å¤„ç†è¾“å‡º...
```

### äº‹ä»¶ç³»ç»Ÿé›†æˆ

è·¯ç”±æ‰§è¡Œä¸Agnoçš„å®Œæ•´äº‹ä»¶ç³»ç»Ÿé›†æˆï¼Œæä¾›è¯¦ç»†çš„æ‰§è¡Œè·Ÿè¸ªï¼š

```mermaid
classDiagram
class RouterExecutionStartedEvent {
+event : str
+step_name : Optional[str]
+step_index : Optional[Union[int, tuple]]
+selected_steps : List[str]
}
class RouterExecutionCompletedEvent {
+event : str
+step_name : Optional[str]
+step_index : Optional[Union[int, tuple]]
+selected_steps : List[str]
+executed_steps : Optional[int]
+step_results : List[StepOutput]
}
class BaseWorkflowRunOutputEvent {
+created_at : int
+workflow_id : Optional[str]
+workflow_name : Optional[str]
+session_id : Optional[str]
+run_id : Optional[str]
+step_id : Optional[str]
+parent_step_id : Optional[str]
}
BaseWorkflowRunOutputEvent <|-- RouterExecutionStartedEvent
BaseWorkflowRunOutputEvent <|-- RouterExecutionCompletedEvent
```

**å›¾è¡¨æ¥æº**
- [workflow.py](file://libs/agno/agno/run/workflow.py#L304-L320)

**ç« èŠ‚æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L400-L500)
- [workflow.py](file://libs/agno/agno/run/workflow.py#L304-L320)

## ä¾èµ–å…³ç³»åˆ†æ

è·¯ç”±æ‰§è¡Œç³»ç»Ÿçš„ä¾èµ–å…³ç³»å±•ç°äº†æ¸…æ™°çš„å±‚æ¬¡ç»“æ„ï¼š

```mermaid
graph TB
subgraph "å¤–éƒ¨ä¾èµ–"
A[FastAPI] --> B[WebSocketæ”¯æŒ]
C[Pydantic] --> D[æ•°æ®éªŒè¯]
E[UUID] --> F[å”¯ä¸€æ ‡è¯†ç¬¦]
end
subgraph "å†…éƒ¨æ¨¡å—"
G[agno.run.agent] --> H[Agentè¿è¡Œæ—¶]
I[agno.run.team] --> J[Teamè¿è¡Œæ—¶]
K[agno.run.workflow] --> L[å·¥ä½œæµäº‹ä»¶]
M[agno.utils.log] --> N[æ—¥å¿—è®°å½•]
O[agno.workflow.step] --> P[åŸºç¡€æ­¥éª¤]
Q[agno.workflow.types] --> R[ç±»å‹å®šä¹‰]
end
subgraph "è·¯ç”±æ ¸å¿ƒ"
S[Routerç±»] --> T[é€‰æ‹©å™¨å‡½æ•°]
S --> U[æ­¥éª¤é›†åˆ]
S --> V[æ‰§è¡Œå™¨]
end
S --> H
S --> J
S --> L
S --> N
S --> P
S --> R
```

**å›¾è¡¨æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L1-L20)

**ç« èŠ‚æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L1-L20)

## æ€§èƒ½è€ƒè™‘

### å†…å­˜ç®¡ç†

è·¯ç”±ç³»ç»Ÿé‡‡ç”¨äº†é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼š

1. **æƒ°æ€§åŠ è½½**ï¼šæ­¥éª¤åªåœ¨éœ€è¦æ—¶æ‰è¢«å‡†å¤‡å’Œæ‰§è¡Œ
2. **æµå¼å¤„ç†**ï¼šæ”¯æŒå¤§å®¹é‡æ•°æ®çš„æµå¼å¤„ç†
3. **èµ„æºæ¸…ç†**ï¼šåŠæ—¶é‡Šæ”¾ä¸å†éœ€è¦çš„èµ„æº

### å¹¶å‘å¤„ç†

è·¯ç”±ç³»ç»Ÿæ”¯æŒå¤šç§å¹¶å‘æ¨¡å¼ï¼š

- **å¼‚æ­¥æ‰§è¡Œ**ï¼šå®Œå…¨å¼‚æ­¥çš„æ­¥éª¤æ‰§è¡Œ
- **æµå¼å¤„ç†**ï¼šå®æ—¶å“åº”çš„æµå¼è¾“å‡º
- **å¹¶è¡Œæ­¥éª¤**ï¼šæ”¯æŒå¹¶è¡Œæ‰§è¡Œå¤šä¸ªæ­¥éª¤

### é”™è¯¯å¤„ç†

ç³»ç»Ÿæä¾›äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

```python
try:
    step_output = step.execute(...)
except Exception as e:
    step_name = getattr(step, "name", f"step_{i}")
    logger.error(f"Router step {step_name} failed: {e}")
    error_output = StepOutput(
        step_name=step_name,
        content=f"Step {step_name} failed: {str(e)}",
        success=False,
        error=str(e),
    )
    all_results.append(error_output)
    break
```

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **è·¯ç”±é€‰æ‹©å™¨è¿”å›æ— æ•ˆç±»å‹**
   - ç¡®ä¿é€‰æ‹©å™¨å‡½æ•°è¿”å›`Step`å¯¹è±¡æˆ–`Step`å¯¹è±¡åˆ—è¡¨
   - æ£€æŸ¥é€‰æ‹©å™¨å‡½æ•°çš„è¿”å›å€¼ç±»å‹

2. **æ­¥éª¤æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥æ­¥éª¤é…ç½®æ˜¯å¦æ­£ç¡®
   - éªŒè¯æ­¥éª¤ä¾èµ–é¡¹æ˜¯å¦å­˜åœ¨

3. **æµå¼æ‰§è¡Œä¸­æ–­**
   - ç¡®ä¿æ‰€æœ‰æ­¥éª¤éƒ½æ”¯æŒæµå¼æ‰§è¡Œ
   - æ£€æŸ¥äº‹ä»¶ç³»ç»Ÿçš„é…ç½®

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼šè®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºDEBUG
2. **ä½¿ç”¨äº‹ä»¶ç›‘å¬**ï¼šç›‘å¬è·¯ç”±æ‰§è¡Œäº‹ä»¶
3. **æ£€æŸ¥ä¸­é—´çŠ¶æ€**ï¼šéªŒè¯æ­¥éª¤é—´çš„æ•°æ®ä¼ é€’

**ç« èŠ‚æ¥æº**
- [router.py](file://libs/agno/agno/workflow/router.py#L172-L200)
- [test_router_steps.py](file://libs/agno/tests/integration/workflows/test_router_steps.py#L80-L120)

## ç»“è®º

Agnoæ¡†æ¶çš„è·¯ç”±æ‰§è¡Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„åŠ¨æ€è·¯ç”±è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡`Router`ç±»ï¼Œå¼€å‘è€…å¯ä»¥åˆ›å»ºæ™ºèƒ½çš„å·¥ä½œæµï¼Œæ ¹æ®è¾“å…¥å†…å®¹æˆ–ä¸Šä¸‹æ–‡ä¿¡æ¯è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„å¤„ç†è·¯å¾„ã€‚

### ä¸»è¦ä¼˜åŠ¿

1. **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§ç±»å‹çš„æ­¥éª¤å’Œå¤æ‚çš„è·¯ç”±é€»è¾‘
2. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„æ­¥éª¤ç±»å‹å’Œè·¯ç”±ç­–ç•¥
3. **å¯é æ€§**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
4. **å¯è§‚æµ‹æ€§**ï¼šå®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿæ”¯æŒç›‘æ§å’Œè°ƒè¯•
5. **æ€§èƒ½**ï¼šæ”¯æŒå¼‚æ­¥å’Œæµå¼æ‰§è¡Œï¼Œé€‚åº”é«˜å¹¶å‘åœºæ™¯

### æœ€ä½³å®è·µå»ºè®®

1. **è®¾è®¡ç®€æ´çš„é€‰æ‹©å™¨**ï¼šä¿æŒè·¯ç”±é€»è¾‘ç®€å•æ˜äº†
2. **åˆç†ä½¿ç”¨æ—©æœŸç»ˆæ­¢**ï¼šåœ¨é€‚å½“çš„åœ°æ–¹å®ç°å®‰å…¨æ£€æŸ¥
3. **å……åˆ†åˆ©ç”¨äº‹ä»¶ç³»ç»Ÿ**ï¼šä½¿ç”¨äº‹ä»¶è¿›è¡Œç›‘æ§å’Œè°ƒè¯•
4. **ä¼˜åŒ–æ­¥éª¤é“¾**ï¼šåˆç†å®‰æ’æ­¥éª¤é¡ºåºä»¥æé«˜æ•ˆç‡
5. **å®æ–½é”™è¯¯å¤„ç†**ï¼šä¸ºæ¯ä¸ªæ­¥éª¤é…ç½®é€‚å½“çš„é”™è¯¯å¤„ç†ç­–ç•¥

è·¯ç”±æ‰§è¡Œç³»ç»Ÿä¸ºAgnoæ¡†æ¶æä¾›äº†å¼ºå¤§çš„å·¥ä½œæµç¼–æ’èƒ½åŠ›ï¼Œä½¿å¾—æ„å»ºå¤æ‚ã€æ™ºèƒ½çš„åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚