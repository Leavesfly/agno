# AgentOSä»£ç çº§å®šåˆ¶æ·±åº¦æŒ‡å—

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [custom_fastapi_app.py](file://cookbook/agent_os/customize/custom_fastapi_app.py)
- [fastapi_app_with_custom_middleware.py](file://cookbook/agent_os/customize/fastapi_app_with_custom_middleware.py)
- [custom_lifespan.py](file://cookbook/agent_os/customize/custom_lifespan.py)
- [override_routes.py](file://cookbook/agent_os/customize/override_routes.py)
- [app.py](file://libs/agno/agno/os/app.py)
- [home.py](file://libs/agno/agno/os/routers/home.py)
- [health.py](file://libs/agno/agno/os/routers/health.py)
- [settings.py](file://libs/agno/agno/os/settings.py)
- [test_custom_fastapi_app.py](file://libs/agno/tests/integration/os/test_custom_fastapi_app.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒå®šåˆ¶ç»„ä»¶](#æ ¸å¿ƒå®šåˆ¶ç»„ä»¶)
4. [FastAPIåº”ç”¨å®šåˆ¶](#fastapiåº”ç”¨å®šåˆ¶)
5. [ä¸­é—´ä»¶é›†æˆ](#ä¸­é—´ä»¶é›†æˆ)
6. [ç”Ÿå‘½å‘¨æœŸç®¡ç†](#ç”Ÿå‘½å‘¨æœŸç®¡ç†)
7. [è·¯ç”±å†²çªå¤„ç†](#è·¯ç”±å†²çªå¤„ç†)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
9. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
10. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹

AgentOSæ˜¯ä¸€ä¸ªå¼ºå¤§çš„AIä»£ç†æ“ä½œç³»ç»Ÿï¼Œæä¾›äº†ä¸°å¯Œçš„ä»£ç çº§å®šåˆ¶èƒ½åŠ›ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡ç¼–ç¨‹æ–¹å¼æ‰©å±•é»˜è®¤çš„FastAPIåº”ç”¨ï¼ŒåŒ…æ‹¬åˆ›å»ºè‡ªå®šä¹‰FastAPIå®ä¾‹ã€æ³¨å…¥è‡ªå®šä¹‰ä¸­é—´ä»¶ä»¥å®ç°è®¤è¯ã€æ—¥å¿—è®°å½•æˆ–æ€§èƒ½ç›‘æ§ï¼Œä»¥åŠå®‰å…¨åœ°è¦†ç›–æˆ–æ‰©å±•å†…ç½®è·¯ç”±å’ŒAPIç«¯ç‚¹ã€‚

AgentOSçš„è®¾è®¡å…è®¸å¼€å‘è€…åœ¨ä¿æŒæ ¸å¿ƒåŠŸèƒ½çš„åŒæ—¶ï¼Œçµæ´»åœ°æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## é¡¹ç›®æ¶æ„æ¦‚è§ˆ

AgentOSé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œä¸»è¦ç»„ä»¶åŒ…æ‹¬ï¼š

```mermaid
graph TB
subgraph "AgentOSæ ¸å¿ƒæ¶æ„"
AgentOS[AgentOSä¸»ç±»]
FastAPI[FastAPIåº”ç”¨]
Routers[è·¯ç”±ç³»ç»Ÿ]
Middleware[ä¸­é—´ä»¶å±‚]
Lifespan[ç”Ÿå‘½å‘¨æœŸç®¡ç†]
end
subgraph "å®šåˆ¶æ‰©å±•ç‚¹"
CustomApp[è‡ªå®šä¹‰FastAPIåº”ç”¨]
CustomMW[è‡ªå®šä¹‰ä¸­é—´ä»¶]
CustomRoutes[è‡ªå®šä¹‰è·¯ç”±]
CustomLifespan[è‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸ]
end
AgentOS --> FastAPI
FastAPI --> Routers
FastAPI --> Middleware
FastAPI --> Lifespan
CustomApp -.-> FastAPI
CustomMW -.-> Middleware
CustomRoutes -.-> Routers
CustomLifespan -.-> Lifespan
```

**å›¾è¡¨æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L1-L50)
- [settings.py](file://libs/agno/agno/os/settings.py#L1-L20)

## æ ¸å¿ƒå®šåˆ¶ç»„ä»¶

### AgentOSä¸»ç±»è®¾è®¡

AgentOSç±»æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œæä¾›äº†ä¸°å¯Œçš„åˆå§‹åŒ–å‚æ•°æ¥æ”¯æŒå„ç§å®šåˆ¶éœ€æ±‚ï¼š

```python
class AgentOS:
    def __init__(
        self,
        os_id: Optional[str] = None,
        name: Optional[str] = None,
        description: Optional[str] = None,
        version: Optional[str] = None,
        agents: Optional[List[Agent]] = None,
        teams: Optional[List[Team]] = None,
        workflows: Optional[List[Workflow]] = None,
        interfaces: Optional[List[BaseInterface]] = None,
        config: Optional[Union[str, AgentOSConfig]] = None,
        settings: Optional[AgnoAPISettings] = None,
        fastapi_app: Optional[FastAPI] = None,
        lifespan: Optional[Any] = None,
        enable_mcp: bool = False,
        replace_routes: bool = True,
        telemetry: bool = True,
    ):
```

**ç« èŠ‚æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L50-L120)

### é…ç½®ç³»ç»Ÿ

AgentOSæä¾›äº†çµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒYAMLé…ç½®æ–‡ä»¶å’Œç¨‹åºåŒ–é…ç½®ï¼š

```mermaid
classDiagram
class AgentOSConfig {
+SessionConfig session
+MemoryConfig memory
+KnowledgeConfig knowledge
+MetricsConfig metrics
+EvalsConfig evals
}
class AgnoAPISettings {
+str env
+bool docs_enabled
+Optional~str~ os_security_key
+Optional~str[]~ cors_origin_list
}
class DatabaseConfig {
+str db_id
+DatabaseDomainConfig domain_config
}
AgentOSConfig --> SessionConfig
AgentOSConfig --> MemoryConfig
AgentOSConfig --> KnowledgeConfig
AgentOSConfig --> MetricsConfig
AgentOSConfig --> EvalsConfig
SessionConfig --> DatabaseConfig
MemoryConfig --> DatabaseConfig
KnowledgeConfig --> DatabaseConfig
MetricsConfig --> DatabaseConfig
EvalsConfig --> DatabaseConfig
```

**å›¾è¡¨æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L20-L40)

## FastAPIåº”ç”¨å®šåˆ¶

### åˆ›å»ºè‡ªå®šä¹‰FastAPIå®ä¾‹

AgentOSå…è®¸å®Œå…¨æ›¿æ¢é»˜è®¤çš„FastAPIåº”ç”¨ï¼ŒåŒæ—¶ä¿ç•™æ‰€æœ‰å†…ç½®åŠŸèƒ½ï¼š

```python
from agno.agent import Agent
from agno.db.postgres import PostgresDb
from agno.models.anthropic import Claude
from agno.os import AgentOS
from fastapi import FastAPI

# è®¾ç½®æ•°æ®åº“
db = PostgresDb(db_url="postgresql+psycopg://ai:ai@localhost:5532/ai")

# åˆ›å»ºä»£ç†
web_research_agent = Agent(
    id="web-research-agent",
    name="Web Research Agent",
    model=Claude(id="claude-sonnet-4-0"),
    db=db,
    tools=[DuckDuckGoTools()],
    add_history_to_context=True,
    num_history_runs=3,
    add_datetime_to_context=True,
    markdown=True,
)

# è‡ªå®šä¹‰FastAPIåº”ç”¨
app: FastAPI = FastAPI(
    title="Custom FastAPI App",
    version="1.0.0",
)

# æ·»åŠ è‡ªå®šä¹‰è·¯ç”±
@app.post("/customers")
async def get_customers():
    return [
        {
            "id": 1,
            "name": "John Doe",
            "email": "john.doe@example.com",
        },
        {
            "id": 2,
            "name": "Jane Doe",
            "email": "jane.doe@example.com",
        },
    ]

# ä½¿ç”¨è‡ªå®šä¹‰FastAPIåº”ç”¨åˆ›å»ºAgentOS
agent_os = AgentOS(
    description="Example app with custom routers",
    agents=[web_research_agent],
    fastapi_app=app,
)

app = agent_os.get_app()
```

**ç« èŠ‚æ¥æº**
- [custom_fastapi_app.py](file://cookbook/agent_os/customize/custom_fastapi_app.py#L1-L79)

### è·¯ç”±ç³»ç»Ÿæ¶æ„

AgentOSçš„è·¯ç”±ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±ç®¡ç†å’Œå†²çªæ£€æµ‹ï¼š

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·è¯·æ±‚
participant CustomApp as è‡ªå®šä¹‰åº”ç”¨
participant AgentOS as AgentOSæ ¸å¿ƒ
participant BuiltInRouters as å†…ç½®è·¯ç”±å™¨
participant RouteConflict as è·¯ç”±å†²çªæ£€æµ‹
User->>CustomApp : å‘é€HTTPè¯·æ±‚
CustomApp->>RouteConflict : æ£€æŸ¥è·¯ç”±å†²çª
RouteConflict->>RouteConflict : åˆ†æç°æœ‰è·¯ç”±
alt å­˜åœ¨å†²çªä¸”replace_routes=True
RouteConflict->>BuiltInRouters : ç§»é™¤å†²çªè·¯ç”±
BuiltInRouters->>CustomApp : æ·»åŠ AgentOSè·¯ç”±
else ä¸å­˜åœ¨å†²çªæˆ–replace_routes=False
CustomApp->>CustomApp : ä¿ç•™è‡ªå®šä¹‰è·¯ç”±
BuiltInRouters->>CustomApp : æ·»åŠ éå†²çªè·¯ç”±
end
CustomApp->>AgentOS : å¤„ç†è¯·æ±‚
AgentOS->>User : è¿”å›å“åº”
```

**å›¾è¡¨æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L350-L390)

## ä¸­é—´ä»¶é›†æˆ

### è‡ªå®šä¹‰ä¸­é—´ä»¶å®ç°

AgentOSæ”¯æŒå®Œæ•´çš„ä¸­é—´ä»¶æ ˆé›†æˆï¼Œå…è®¸å¼€å‘è€…æ·»åŠ è®¤è¯ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰åŠŸèƒ½ï¼š

```python
from fastapi import Request, Response
from fastapi.responses import JSONResponse
from starlette.middleware.base import BaseHTTPMiddleware

# è¯·æ±‚/å“åº”æ—¥å¿—ä¸­é—´ä»¶
class RequestLoggingMiddleware(BaseHTTPMiddleware):
    """
    å¸¦æœ‰è®¡æ—¶å’ŒåŸºæœ¬ä¿¡æ¯çš„è¯·æ±‚/å“åº”æ—¥å¿—ä¸­é—´ä»¶ã€‚
    """
    def __init__(self, app, log_body: bool = False, log_headers: bool = False):
        super().__init__(app)
        self.log_body = log_body
        self.log_headers = log_headers
        self.request_count = 0

    async def dispatch(self, request: Request, call_next) -> Response:
        self.request_count += 1
        start_time = time.time()

        # åŸºæœ¬è¯·æ±‚ä¿¡æ¯
        client_ip = request.client.host if request.client else "unknown"
        print(f"ğŸ” Request #{self.request_count}: {request.method} {request.url.path} from {client_ip}")

        # å¯é€‰ï¼šè®°å½•è¯·æ±‚ä½“
        if self.log_body and request.method in ["POST", "PUT", "PATCH"]:
            body = await request.body()
            if body:
                print(f"ğŸ“ Body: {body.decode()}")

        # å¤„ç†è¯·æ±‚
        response = await call_next(request)

        # è®°å½•å“åº”ä¿¡æ¯
        duration = time.time() - start_time
        status_emoji = "âœ…" if response.status_code < 400 else "âŒ"
        print(f"{status_emoji} Response: {response.status_code} in {duration * 1000:.1f}ms")

        # å°†è¯·æ±‚è®¡æ•°æ·»åŠ åˆ°å“åº”å¤´
        response.headers["X-Request-Count"] = str(self.request_count)

        return response
```

**ç« èŠ‚æ¥æº**
- [fastapi_app_with_custom_middleware.py](file://cookbook/agent_os/customize/fastapi_app_with_custom_middleware.py#L70-L120)

### ä¸­é—´ä»¶æ‰§è¡Œæµç¨‹

```mermaid
flowchart TD
Start([è¯·æ±‚å¼€å§‹]) --> CheckMiddleware["æ£€æŸ¥ä¸­é—´ä»¶æ ˆ"]
CheckMiddleware --> CustomMW{"è‡ªå®šä¹‰ä¸­é—´ä»¶?"}
CustomMW --> |æ˜¯| CustomLogic["æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘<br/>- è®¤è¯æ£€æŸ¥<br/>- æ—¥å¿—è®°å½•<br/>- æ€§èƒ½ç›‘æ§"]
CustomMW --> |å¦| AgentOSMW["æ‰§è¡ŒAgentOSä¸­é—´ä»¶<br/>- CORSå¤„ç†<br/>- å¼‚å¸¸å¤„ç†<br/>- å®‰å…¨æ£€æŸ¥"]
CustomLogic --> CallNext["è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶"]
AgentOSMW --> CallNext
CallNext --> ProcessRequest["å¤„ç†ä¸šåŠ¡é€»è¾‘"]
ProcessRequest --> GenerateResponse["ç”Ÿæˆå“åº”"]
GenerateResponse --> ReverseOrder["æŒ‰ç›¸åé¡ºåºæ‰§è¡Œä¸­é—´ä»¶"]
ReverseOrder --> AgentOSMWReverse["AgentOSä¸­é—´ä»¶é€†åºæ‰§è¡Œ"]
AgentOSMWReverse --> CustomMWReverse{"è‡ªå®šä¹‰ä¸­é—´ä»¶é€†åºæ‰§è¡Œ"}
CustomMWReverse --> |æ˜¯| CustomLogicReverse["æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘é€†åº"]
CustomMWReverse --> |å¦| End([å“åº”ç»“æŸ])
CustomLogicReverse --> End
```

**å›¾è¡¨æ¥æº**
- [fastapi_app_with_custom_middleware.py](file://cookbook/agent_os/customize/fastapi_app_with_custom_middleware.py#L1-L50)

### å¤šä¸­é—´ä»¶åä½œ

AgentOSæ”¯æŒå¤šä¸ªä¸­é—´ä»¶çš„åè°ƒå·¥ä½œï¼Œç¡®ä¿è‡ªå®šä¹‰ä¸­é—´ä»¶å’Œå†…ç½®ä¸­é—´ä»¶èƒ½å¤Ÿæ­£ç¡®äº¤äº’ï¼š

```python
# æ·»åŠ å¤šä¸ªä¸­é—´ä»¶
app.add_middleware(
    RateLimitMiddleware,
    requests_per_minute=10,
    window_size=60,
)

app.add_middleware(
    RequestLoggingMiddleware,
    log_body=False,
    log_headers=False,
)
```

**ç« èŠ‚æ¥æº**
- [fastapi_app_with_custom_middleware.py](file://cookbook/agent_os/customize/fastapi_app_with_custom_middleware.py#L170-L181)

## ç”Ÿå‘½å‘¨æœŸç®¡ç†

### è‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸå®ç°

AgentOSæ”¯æŒè‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥ã€ç¼“å­˜å’Œå…¶ä»–èµ„æºï¼š

```python
from contextlib import asynccontextmanager
from agno.utils.log import log_info

@asynccontextmanager
async def lifespan(app):
    log_info("Starting My FastAPI App")
    yield
    log_info("Stopping My FastAPI App")

agent_os = AgentOS(
    description="Example app with custom lifespan",
    agents=[agno_support_agent],
    lifespan=lifespan,
)
```

**ç« èŠ‚æ¥æº**
- [custom_lifespan.py](file://cookbook/agent_os/customize/custom_lifespan.py#L1-L51)

### ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†

```mermaid
stateDiagram-v2
[*] --> ApplicationStartup
ApplicationStartup --> ResourceInitialization : å¯åŠ¨äº‹ä»¶
ResourceInitialization --> ApplicationRunning : åˆå§‹åŒ–å®Œæˆ
ApplicationRunning --> ResourceCleanup : å…³é—­äº‹ä»¶
ResourceCleanup --> ApplicationShutdown : æ¸…ç†å®Œæˆ
ApplicationShutdown --> [*]
note right of ResourceInitialization
æ•°æ®åº“è¿æ¥
ç¼“å­˜åˆå§‹åŒ–
MCPå·¥å…·è¿æ¥
å…¶ä»–èµ„æº
end note
note right of ResourceCleanup
æ•°æ®åº“æ–­å¼€
ç¼“å­˜æ¸…ç†
MCPå·¥å…·å…³é—­
èµ„æºé‡Šæ”¾
end note
```

**å›¾è¡¨æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L150-L200)

### MCPå·¥å…·ç”Ÿå‘½å‘¨æœŸ

å¯¹äºä½¿ç”¨MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰çš„AgentOSå®ä¾‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†MCPè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸï¼š

```python
@asynccontextmanager
async def mcp_lifespan(app, mcp_tools):
    """ç®¡ç†MCPè¿æ¥ç”Ÿå‘½å‘¨æœŸ"""
    # å¯åŠ¨é€»è¾‘ï¼šè¿æ¥åˆ°æ‰€æœ‰ä¸Šä¸‹æ–‡MCPæœåŠ¡å™¨
    for tool in mcp_tools:
        await tool.connect()

    yield

    # å…³é—­é€»è¾‘ï¼šå…³é—­æ‰€æœ‰ä¸Šä¸‹æ–‡MCPè¿æ¥
    for tool in mcp_tools:
        await tool.close()
```

**ç« èŠ‚æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L60-L75)

## è·¯ç”±å†²çªå¤„ç†

### å†²çªæ£€æµ‹æœºåˆ¶

AgentOSå®ç°äº†æ™ºèƒ½çš„è·¯ç”±å†²çªæ£€æµ‹å’Œå¤„ç†æœºåˆ¶ï¼š

```python
def _add_router(self, router: APIRouter) -> None:
    """æ·»åŠ è·¯ç”±å™¨åˆ°FastAPIåº”ç”¨ï¼Œé¿å…è·¯ç”±å†²çªã€‚"""
    if not self.fastapi_app:
        return

    # è·å–ç°æœ‰è·¯ç”±
    existing_paths = self._get_existing_route_paths()

    # æ£€æŸ¥å†²çª
    conflicts = []
    conflicting_routes = []

    for route in router.routes:
        if isinstance(route, APIRoute):
            full_path = route.path
            route_methods = list(route.methods) if route.methods else []

            if full_path in existing_paths:
                conflicting_methods: Set[str] = set(route_methods) & set(existing_paths[full_path])
                if conflicting_methods:
                    conflicts.append({
                        "path": full_path, 
                        "methods": list(conflicting_methods), 
                        "route": route
                    })
                    conflicting_routes.append(route)

    # å¤„ç†å†²çª
    if conflicts and self._app_set:
        if self.replace_routes:
            # è®°å½•è­¦å‘Šä½†ä»æ·»åŠ æ‰€æœ‰è·¯ç”±ï¼ˆAgentOSè·¯ç”±å°†è¦†ç›–ï¼‰
            for conflict in conflicts:
                methods_str = ", ".join(conflict["methods"])
                logger.warning(
                    f"æ£€æµ‹åˆ°è·¯ç”±å†²çª: {methods_str} {conflict['path']} - "
                    f"AgentOSè·¯ç”±å°†è¦†ç›–ç°æœ‰è‡ªå®šä¹‰è·¯ç”±"
                )
            
            # ç§»é™¤å†²çªè·¯ç”±
            for route in self.fastapi_app.routes:
                for conflict in conflicts:
                    if isinstance(route, APIRoute):
                        if route.path == conflict["path"] and list(route.methods) == list(conflict["methods"]):
                            self.fastapi_app.routes.pop(self.fastapi_app.routes.index(route))

            self.fastapi_app.include_router(router)
```

**ç« èŠ‚æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L350-L390)

### è·¯ç”±ä¼˜å…ˆçº§ç­–ç•¥

```mermaid
flowchart TD
NewRoute[æ–°è·¯ç”±æ·»åŠ ] --> CheckConflicts[æ£€æŸ¥å†²çª]
CheckConflicts --> HasConflicts{"å­˜åœ¨å†²çª?"}
HasConflicts --> |å¦| AddDirectly[ç›´æ¥æ·»åŠ è·¯ç”±]
HasConflicts --> |æ˜¯| CheckReplaceFlag[æ£€æŸ¥replace_routesæ ‡å¿—]
CheckReplaceFlag --> ReplaceTrue{"replace_routes=True?"}
ReplaceTrue --> |æ˜¯| LogWarning[è®°å½•è­¦å‘Š]
ReplaceTrue --> |å¦| FilterRoutes[è¿‡æ»¤å†²çªè·¯ç”±]
LogWarning --> RemoveConflicts[ç§»é™¤å†²çªè·¯ç”±]
FilterRoutes --> PreserveCustom[ä¿ç•™è‡ªå®šä¹‰è·¯ç”±]
RemoveConflicts --> AddAgentOS[æ·»åŠ AgentOSè·¯ç”±]
PreserveCustom --> AddFiltered[æ·»åŠ è¿‡æ»¤åè·¯ç”±]
AddDirectly --> Complete[å®Œæˆ]
AddAgentOS --> Complete
AddFiltered --> Complete
```

**å›¾è¡¨æ¥æº**
- [app.py](file://libs/agno/agno/os/app.py#L350-L390)

### è‡ªå®šä¹‰è·¯ç”±ä¼˜å…ˆçº§

å½“ä½¿ç”¨`replace_routes=False`æ—¶ï¼ŒAgentOSä¼šä¼˜å…ˆä¿ç•™è‡ªå®šä¹‰è·¯ç”±ï¼š

```python
# ä½¿ç”¨replace_routes=Falseä¿ç•™è‡ªå®šä¹‰è·¯ç”±
agent_os = AgentOS(
    description="Example app with route replacement",
    agents=[web_research_agent],
    fastapi_app=app,
    replace_routes=False,  # è·³è¿‡å†²çªçš„AgentOSè·¯ç”±ï¼Œä¿ç•™è‡ªå®šä¹‰è·¯ç”±
)
```

**ç« èŠ‚æ¥æº**
- [override_routes.py](file://cookbook/agent_os/customize/override_routes.py#L50-L60)

## æœ€ä½³å®è·µ

### 1. ä¸­é—´ä»¶è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªä¸­é—´ä»¶åº”ä¸“æ³¨äºå•ä¸€åŠŸèƒ½
- **æ€§èƒ½è€ƒè™‘**ï¼šé¿å…åœ¨ä¸­é—´ä»¶ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- **é”™è¯¯å¤„ç†**ï¼šç¡®ä¿ä¸­é—´ä»¶èƒ½å¤Ÿä¼˜é›…å¤„ç†å¼‚å¸¸
- **çŠ¶æ€ç®¡ç†**ï¼šåˆç†ä½¿ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¼ é€’çŠ¶æ€

### 2. ç”Ÿå‘½å‘¨æœŸç®¡ç†

- **èµ„æºéš”ç¦»**ï¼šç¡®ä¿ä¸åŒç»„ä»¶çš„èµ„æºç‹¬ç«‹ç®¡ç†
- **å¼‚å¸¸æ¢å¤**ï¼šåœ¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†
- **æ€§èƒ½ç›‘æ§**ï¼šåœ¨å¯åŠ¨å’Œå…³é—­é˜¶æ®µæ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†

### 3. è·¯ç”±è®¾è®¡

- **å‘½åç©ºé—´**ï¼šä¸ºè‡ªå®šä¹‰è·¯ç”±ä½¿ç”¨æ˜ç¡®çš„å‘½åç©ºé—´
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šåœ¨è·¯ç”±è·¯å¾„ä¸­åŒ…å«ç‰ˆæœ¬ä¿¡æ¯
- **æ–‡æ¡£å®Œæ•´**ï¼šä¸ºè‡ªå®šä¹‰è·¯ç”±æä¾›å®Œæ•´çš„APIæ–‡æ¡£

### 4. é…ç½®ç®¡ç†

- **ç¯å¢ƒå˜é‡**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†é…ç½®
- **é…ç½®éªŒè¯**ï¼šç¡®ä¿é…ç½®çš„æœ‰æ•ˆæ€§
- **é»˜è®¤å€¼**ï¼šæä¾›åˆç†çš„é»˜è®¤é…ç½®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. è·¯ç”±å†²çª

**é—®é¢˜**ï¼šè‡ªå®šä¹‰è·¯ç”±è¢«AgentOSè·¯ç”±è¦†ç›–

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨replace_routes=False
agent_os = AgentOS(
    agents=[agents],
    fastapi_app=custom_app,
    replace_routes=False,
)
```

#### 2. ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºé—®é¢˜

**é—®é¢˜**ï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶æœªæŒ‰é¢„æœŸæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ˜ç¡®æŒ‡å®šä¸­é—´ä»¶æ·»åŠ é¡ºåº
app.add_middleware(CustomMiddleware1)
app.add_middleware(CustomMiddleware2)
```

#### 3. ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æœªè§¦å‘

**é—®é¢˜**ï¼šè‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æœªæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è£…é¥°å™¨
@asynccontextmanager
async def lifespan(app):
    # å¯åŠ¨é€»è¾‘
    yield
    # å…³é—­é€»è¾‘
```

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼šè®¾ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«
2. **ä¸­é—´ä»¶é“¾æ£€æŸ¥**ï¼šéªŒè¯ä¸­é—´ä»¶æ˜¯å¦æ­£ç¡®æ³¨å†Œ
3. **è·¯ç”±åˆ—è¡¨æ£€æŸ¥**ï¼šä½¿ç”¨`get_routes()`æ–¹æ³•æ£€æŸ¥è·¯ç”±çŠ¶æ€
4. **ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è·Ÿè¸ª**ï¼šåœ¨å…³é”®ç‚¹æ·»åŠ æ—¥å¿—è¾“å‡º

**ç« èŠ‚æ¥æº**
- [test_custom_fastapi_app.py](file://libs/agno/tests/integration/os/test_custom_fastapi_app.py#L1-L50)

## æ€»ç»“

AgentOSæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ä»£ç çº§å®šåˆ¶èƒ½åŠ›ï¼Œé€šè¿‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§æ”¯æŒå¼€å‘è€…ï¼š

1. **å®Œå…¨å¯å®šåˆ¶çš„FastAPIåº”ç”¨**ï¼šæ”¯æŒæ›¿æ¢é»˜è®¤åº”ç”¨å¹¶ä¿ç•™æ‰€æœ‰å†…ç½®åŠŸèƒ½
2. **çµæ´»çš„ä¸­é—´ä»¶é›†æˆ**ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸­é—´ä»¶æ·»åŠ å’Œå¤šä¸­é—´ä»¶åä½œ
3. **æ™ºèƒ½è·¯ç”±å†²çªå¤„ç†**ï¼šæä¾›å¤šç§è·¯ç”±ä¼˜å…ˆçº§ç­–ç•¥
4. **å®Œå–„çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ”¯æŒè‡ªå®šä¹‰èµ„æºç®¡ç†å’ŒMCPå·¥å…·ç”Ÿå‘½å‘¨æœŸ
5. **ä¸°å¯Œçš„é…ç½®é€‰é¡¹**ï¼šæ”¯æŒYAMLé…ç½®å’Œç¨‹åºåŒ–é…ç½®

è¿™äº›ç‰¹æ€§ä½¿å¾—AgentOSèƒ½å¤Ÿåœ¨ä¿æŒæ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œæ»¡è¶³å„ç§å¤æ‚çš„å®šåˆ¶éœ€æ±‚ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„å®šåˆ¶ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

é€šè¿‡éµå¾ªæœ¬æŒ‡å—ä¸­çš„æœ€ä½³å®è·µå’Œæ•…éšœæ’é™¤å»ºè®®ï¼Œå¼€å‘è€…å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨AgentOSçš„å®šåˆ¶èƒ½åŠ›ï¼Œæ„å»ºç¬¦åˆç‰¹å®šéœ€æ±‚çš„AIä»£ç†æ“ä½œç³»ç»Ÿã€‚