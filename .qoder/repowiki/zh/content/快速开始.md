# Agno 快速开始指南

<cite>
**本文档中引用的文件**
- [README.md](file://cookbook/getting_started/README.md)
- [01_basic_agent.py](file://cookbook/getting_started/01_basic_agent.py)
- [02_agent_with_tools.py](file://cookbook/getting_started/02_agent_with_tools.py)
- [03_agent_with_knowledge.py](file://cookbook/getting_started/03_agent_with_knowledge.py)
- [04_write_your_own_tool.py](file://cookbook/getting_started/04_write_your_own_tool.py)
- [06_agent_with_storage.py](file://cookbook/getting_started/06_agent_with_storage.py)
- [07_agent_state.py](file://cookbook/getting_started/07_agent_state.py)
- [09_agent_session.py](file://cookbook/getting_started/09_agent_session.py)
- [10_user_memories_and_summaries.py](file://cookbook/getting_started/10_user_memories_and_summaries.py)
- [12_human_in_the_loop.py](file://cookbook/getting_started/12_human_in_the_loop.py)
- [13_image_agent.py](file://cookbook/getting_started/13_image_agent.py)
- [14_generate_image.py](file://cookbook/getting_started/14_generate_image.py)
- [17_agent_team.py](file://cookbook/getting_started/17_agent_team.py)
- [18_research_agent_exa.py](file://cookbook/getting_started/18_research_agent_exa.py)
- [agent.py](file://libs/agno/agno/agent/agent.py)
</cite>

## 目录
1. [简介](#简介)
2. [环境搭建](#环境搭建)
3. [第一个智能体](#第一个智能体)
4. [添加工具扩展能力](#添加工具扩展能力)
5. [知识库集成](#知识库集成)
6. [自定义工具开发](#自定义工具开发)
7. [持久化存储](#持久化存储)
8. [状态管理](#状态管理)
9. [会话管理](#会话管理)
10. [多智能体协作](#多智能体协作)
11. [高级功能](#高级功能)
12. [故障排除](#故障排除)
13. [总结](#总结)

## 简介

Agno 是一个强大的 AI 智能体框架，允许开发者轻松创建具有各种能力的智能代理。本指南将带领您从零开始，逐步构建一个完整的、功能齐全的智能体系统。

Agno 的核心特性包括：
- **模块化设计**：支持独立的功能组件
- **多模态支持**：处理文本、图像、音频、视频
- **工具集成**：轻松连接外部 API 和服务
- **知识库集成**：支持向量数据库和 RAG 系统
- **会话管理**：持久化对话历史和状态
- **团队协作**：多个智能体协同工作

## 环境搭建

### 安装依赖

首先，创建虚拟环境并安装必要的依赖包：

```bash
# 创建虚拟环境
python3 -m venv .venv
source .venv/bin/activate

# 安装基础依赖
pip install openai agno

# 安装额外的工具依赖（根据需要）
pip install ddgs yfinance lancedb tantivy pypdf requests exa-py newspaper4k lxml_html_clean sqlalchemy
```

### 配置 API 密钥

设置所需的 API 密钥：

```bash
# OpenAI API 密钥
export OPENAI_API_KEY=your_api_key_here

# EXA API 密钥（用于研究功能）
export EXA_API_KEY=your_exa_api_key_here

# ModelsLab API 密钥（用于视频生成）
export MODELS_LAB_API_KEY=your_models_lab_api_key_here
```

## 第一个智能体

让我们从创建一个简单的新闻报道智能体开始。

### 基础智能体示例

```python
"""纽约风格的新闻报道智能体"""

from textwrap import dedent
from agno.agent import Agent
from agno.models.openai import OpenAIChat

# 创建带有独特个性的新闻报道智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions=dedent("""\
        你是一个充满活力的新闻报道员，擅长讲故事！🗽
        把自己想象成一个机智的喜剧演员和敏锐记者的结合体。

        你的风格指南：
        - 使用表情符号的引人注目的标题开头
        - 以纽约态度分享新闻
        - 保持简洁但有趣的回应
        - 适当加入本地参考和纽约俚语
        - 以"回到演播室"或"从大苹果直播报道"等吸引人的结束语结尾

        记住要验证所有事实，同时保持纽约能量满满！\
    """),
    markdown=True,
)

# 示例使用
agent.print_response(
    "告诉我关于时代广场发生的一条突发新闻故事。", stream=True
)
```

**章节来源**
- [01_basic_agent.py](file://cookbook/getting_started/01_basic_agent.py#L1-L48)

这个示例展示了：
- 如何创建基本的智能体
- 如何设置模型参数
- 如何编写个性化的指令
- 如何启用 Markdown 格式输出
- 如何实现流式响应

## 添加工具扩展能力

智能体的强大之处在于它可以调用外部工具来扩展其能力。

### 带工具的智能体

```python
"""具有网络搜索能力的 AI 新闻伙伴"""

from textwrap import dedent
from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.tools.duckduckgo import DuckDuckGoTools

# 创建具有有趣个性的新闻报道智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions=dedent("""\
        你是一个充满活力的新闻报道员，擅长讲故事！🗽
        把自己想象成一个机智的喜剧演员和敏锐记者的结合体。

        每次报告时遵循以下指南：
        1. 使用搜索工具查找当前、准确的信息
        2. 用真实的纽约热情和当地风味呈现新闻
        3. 将报告结构化为清晰的部分：
           - 吸引人的标题
           - 新闻的简要摘要
           - 关键细节和引言
           - 当地影响或背景
        4. 保持简洁但信息丰富（最多2-3段）
        5. 包含纽约风格的评论和本地参考
        6. 以签名的结束语结尾

        结束语示例：
        - "回到演播室，朋友们！"
        - "从永不眠的城市直播报道！"
        - "我是[你的名字]，从曼哈顿的心脏地带直播！"

        记住：总是通过网络搜索验证事实，同时保持真实的纽约能量！\
    """),
    tools=[DuckDuckGoTools()],
    markdown=True,
)

# 示例使用
agent.print_response(
    "告诉我关于时代广场发生的一条突发新闻故事。", stream=True
)
```

**章节来源**
- [02_agent_with_tools.py](file://cookbook/getting_started/02_agent_with_tools.py#L1-L61)

### 可用的内置工具

Agno 提供了丰富的内置工具集：

- **DuckDuckGoTools**：网络搜索
- **ExaTools**：学术和新闻搜索
- **CalculatorTools**：数学计算
- **FileTools**：文件操作
- **ShellTools**：命令行执行
- **WebTools**：网页抓取
- **YouTubeTools**：视频搜索
- **WikipediaTools**：维基百科查询

## 知识库集成

智能体可以与知识库集成，提供更准确和专业的回答。

### 带知识库的智能体

```python
"""AI烹饪助手！"""

from textwrap import dedent
from agno.agent import Agent
from agno.knowledge.embedder.openai import OpenAIEmbedder
from agno.knowledge.knowledge import Knowledge
from agno.models.openai import OpenAIChat
from agno.tools.duckduckgo import DuckDuckGoTools
from agno.vectordb.lancedb import LanceDb, SearchType

# 设置知识库
knowledge = Knowledge(
    vector_db=LanceDb(
        uri="tmp/lancedb",
        table_name="recipe_knowledge",
        search_type=SearchType.hybrid,
        embedder=OpenAIEmbedder(id="text-embedding-3-small"),
    ),
)

# 添加内容到知识库
knowledge.add_content(
    url="https://agno-public.s3.amazonaws.com/recipes/ThaiRecipes.pdf"
)

# 创建具有泰国菜知识的食谱专家智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions=dedent("""\
        你是一个热情且博学的泰国美食专家！🧑‍🍳
        把自己想象成一个温暖、鼓励的烹饪导师，
        一位泰国美食历史学家和文化大使的结合体。

        回答问题时遵循以下步骤：
        1. 如果用户询问有关泰国美食的问题，始终搜索知识库中的真实泰国食谱和烹饪信息
        2. 如果知识库中的信息不完整，或者用户的问题更适合网络搜索，则搜索网络以补充空白
        3. 如果在知识库中找到信息，无需搜索网络
        4. 总是优先考虑知识库信息而非网络结果以确保真实性
        5. 如有必要，补充网络搜索以获取：
           - 现代化改编或食材替代品
           - 文化背景和历史背景
           - 额外的烹饪技巧和故障排除

        交流风格：
        1. 每个回应以相关的烹饪表情符号开头
        2. 清晰地组织你的回应：
           - 简短的介绍或背景
           - 主要内容（食谱、解释或历史）
           - 技巧或文化洞察
           - 鼓励性的结论
        3. 对于食谱，包括：
           - 可能的替代品的食材列表
           - 清楚的编号烹饪步骤
           - 成功技巧和常见陷阱
        4. 使用友好、鼓励的语言

        特殊功能：
        - 解释不熟悉的泰国食材并建议替代品
        - 分享相关文化背景和传统
        - 提供适应不同饮食需求的技巧
        - 包含用餐建议和配菜

        每个回应以鼓舞人心的结束语结尾，如：
        - "祝你烹饪愉快！ขอให้อร่อย（享受你的美餐）！"
        - "愿你的泰国烹饪冒险带来快乐！"
        - "享受你的自制泰国盛宴！"

        记住：
        - 始终用知识库验证食谱的真实性
        - 明确指出信息来自网络来源
        - 对所有技能水平的家庭厨师都表现出鼓励和支持\
    """),
    knowledge=knowledge,
    tools=[DuckDuckGoTools()],
    markdown=True,
)

# 示例查询
agent.print_response(
    "如何制作椰奶鸡和高良姜汤", stream=True
)
```

**章节来源**
- [03_agent_with_knowledge.py](file://cookbook/getting_started/03_agent_with_knowledge.py#L1-L99)

### 支持的知识库类型

- **LanceDB**：高性能向量数据库
- **Chroma**：开源向量数据库
- **Qdrant**：向量搜索引擎
- **Pinecone**：托管向量数据库
- **Weaviate**：语义搜索引擎
- **PostgreSQL**：关系型数据库
- **MongoDB**：NoSQL 数据库

## 自定义工具开发

您可以创建自己的工具来扩展智能体的能力。

### 自定义工具示例

```python
"""使用 Hacker News API 的自定义工具示例"""

import json
from textwrap import dedent
import httpx
from agno.agent import Agent
from agno.models.openai import OpenAIChat

def get_top_hackernews_stories(num_stories: int = 10) -> str:
    """使用此函数获取 Hacker News 上的热门故事。

    参数:
        num_stories (int): 要返回的故事数量。默认为 10。

    返回:
        str: 热门故事的 JSON 字符串。
    """

    # 获取热门故事 ID
    response = httpx.get("https://hacker-news.firebaseio.com/v0/topstories.json")
    story_ids = response.json()

    # 获取故事详情
    stories = []
    for story_id in story_ids[:num_stories]:
        story_response = httpx.get(
            f"https://hacker-news.firebaseio.com/v0/item/{story_id}.json"
        )
        story = story_response.json()
        if "text" in story:
            story.pop("text", None)
        stories.append(story)
    return json.dumps(stories)

# 创建具有硅谷个性的科技新闻报道智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions=dedent("""\
        你是一个对技术充满热情的 Hacker News 报道员，热爱所有与技术相关的事物！🤖
        把自己想象成一个硅谷内部人士和科技记者的结合体。

        你的风格指南：
        - 使用表情符号的引人注目的技术标题开头
        - 以充满技术前瞻的态度呈现 Hacker News 故事
        - 保持简洁但信息丰富的回应
        - 适当使用技术行业参考和创业术语
        - 以"回到终端！"或"推送到生产环境！"等吸引人的技术主题结束语结尾

        记住要彻底分析 HN 故事，同时保持技术热情高涨！\
    """),
    tools=[get_top_hackernews_stories],
    markdown=True,
)

# 示例问题
agent.print_response("总结 Hacker News 上的前 5 条热门故事？", stream=True)
```

**章节来源**
- [04_write_your_own_tool.py](file://cookbook/getting_started/04_write_your_own_tool.py#L1-L76)

### 工具开发最佳实践

1. **明确的函数签名**：为每个参数提供清晰的文档字符串
2. **错误处理**：实现适当的异常处理
3. **数据格式**：返回标准化的数据格式
4. **性能优化**：考虑异步操作和缓存策略
5. **安全性**：验证输入参数和访问权限

## 持久化存储

智能体可以使用数据库保存状态和历史记录。

### 带存储的智能体

```python
"""AI烹饪助手！"""

from textwrap import dedent
from typing import List, Optional
import typer
from agno.agent import Agent
from agno.db.base import SessionType
from agno.db.sqlite import SqliteDb
from agno.knowledge.embedder.openai import OpenAIEmbedder
from agno.knowledge.knowledge import Knowledge
from agno.models.openai import OpenAIChat
from agno.session import AgentSession
from agno.tools.duckduckgo import DuckDuckGoTools
from agno.vectordb.lancedb import LanceDb, SearchType
from rich import print

# 设置知识库
agent_knowledge = Knowledge(
    vector_db=LanceDb(
        uri="tmp/lancedb",
        table_name="recipe_knowledge",
        search_type=SearchType.hybrid,
        embedder=OpenAIEmbedder(id="text-embedding-3-small"),
    ),
)

# 添加内容到知识库
agent_knowledge.add_content(
    url="https://agno-public.s3.amazonaws.com/recipes/ThaiRecipes.pdf"
)

# 设置数据库
db = SqliteDb(db_file="tmp/agents.db")

def recipe_agent(user: str = "user"):
    session_id: Optional[str] = None

    # 询问用户是否要开始新会话或继续现有会话
    new = typer.confirm("你想开始新的会话吗？")

    if not new:
        existing_sessions: List[AgentSession] = db.get_sessions(  # type: ignore
            user_id=user, session_type=SessionType.AGENT
        )
        if len(existing_sessions) > 0:
            session_id = existing_sessions[0].session_id

    agent = Agent(
        user_id=user,
        session_id=session_id,
        model=OpenAIChat(id="gpt-4o"),
        instructions=dedent("""\
            你是一个热情且博学的泰国美食专家！🧑‍🍳
            把自己想象成一个温暖、鼓励的烹饪导师，
            一位泰国美食历史学家和文化大使的结合体。

            回答问题时遵循以下步骤：
            1. 首先，在知识库中搜索真实的泰国食谱和烹饪信息
            2. 如果知识库中的信息不完整，或者用户的问题更适合网络搜索，则搜索网络以补充空白
            3. 如果在知识库中找到信息，无需搜索网络
            4. 总是优先考虑知识库信息而非网络结果以确保真实性
            5. 如有必要，补充网络搜索以获取：
               - 现代化改编或食材替代品
               - 文化背景和历史背景
               - 额外的烹饪技巧和故障排除

            交流风格：
            1. 每个回应以相关的烹饪表情符号开头
            2. 清晰地组织你的回应：
               - 简短的介绍或背景
               - 主要内容（食谱、解释或历史）
               - 技巧或文化洞察
               - 鼓励性的结论
            3. 对于食谱，包括：
               - 可能的替代品的食材列表
               - 清楚的编号烹饪步骤
               - 成功技巧和常见陷阱
            4. 使用友好、鼓励的语言

            特殊功能：
            - 解释不熟悉的泰国食材并建议替代品
            - 分享相关文化背景和传统
            - 提供适应不同饮食需求的技巧
            - 包含用餐建议和配菜

            每个回应以鼓舞人心的结束语结尾，如：
            - "祝你烹饪愉快！ขอให้อร่อย（享受你的美餐）！"
            - "愿你的泰国烹饪冒险带来快乐！"
            - "享受你的自制泰国盛宴！"

            记住：
            - 始终用知识库验证食谱的真实性
            - 明确指出信息来自网络来源
            - 对所有技能水平的家庭厨师都表现出鼓励和支持\
        """),
        db=db,
        knowledge=agent_knowledge,
        tools=[DuckDuckGoTools()],
        # 为了给智能体提供聊天历史
        # 我们可以：
        # 1. 给智能体提供一个工具来读取聊天历史
        # 2. 自动将聊天历史添加到发送给模型的消息中
        #
        # 1. 给智能体提供一个工具来读取聊天历史
        read_chat_history=True,
        # 2. 自动将聊天历史添加到发送给模型的消息中
        # add_history_to_context=True,
        # 要添加到发送给模型的消息中的历史响应数量
        # num_history_runs=3,
        markdown=True,
    )

    print("你即将与一个智能体聊天！")
    if session_id is None:
        session_id = agent.session_id
        if session_id is not None:
            print(f"开始会话: {session_id}\n")
        else:
            print("开始会话\n")
    else:
        print(f"继续会话: {session_id}\n")

    # 将智能体作为命令行应用程序运行
    agent.cli_app(markdown=True)
```

**章节来源**
- [06_agent_with_storage.py](file://cookbook/getting_started/06_agent_with_storage.py#L1-L145)

### 支持的数据库类型

- **SQLite**：轻量级嵌入式数据库
- **PostgreSQL**：功能强大的关系型数据库
- **MySQL**：流行的开源数据库
- **MongoDB**：NoSQL 文档数据库
- **Redis**：内存数据库
- **DynamoDB**：AWS 托管数据库
- **Firestore**：Google Cloud 数据库

## 状态管理

智能体可以维护状态信息以记住上下文。

### 状态管理示例

```python
"""智能体状态管理示例"""

from agno.agent import Agent
from agno.models.openai import OpenAIChat

# 创建启用了状态管理的智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    enable_agentic_state=True,  # 启用智能体状态
    add_session_state_to_context=True,  # 将状态添加到上下文中
    session_state={"language": "English", "preferences": {}},
    instructions="""
    你是一个多语言智能体助手。
    根据会话状态调整你的响应语言。
    如果状态中没有指定语言，默认使用英语。
    """,
)

# 智能体会自动更新和保存状态
agent.print_response("Hello, how are you?")
```

**章节来源**
- [07_agent_state.py](file://cookbook/getting_started/07_agent_state.py)

### 状态管理功能

- **动态状态更新**：智能体可以在运行过程中修改状态
- **跨会话持久化**：状态可以在多次会话之间保持
- **条件逻辑**：可以根据状态值改变行为
- **个性化体验**：根据用户偏好定制响应

## 会话管理

智能体可以管理对话历史和会话摘要。

### 会话管理示例

```python
"""智能体会话管理示例"""

from agno.agent import Agent
from agno.models.openai import OpenAIChat

# 创建启用了会话摘要的智能体
agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    enable_session_summaries=True,  # 启用会话摘要
    add_session_summary_to_context=True,  # 将摘要添加到上下文中
    instructions="""
    你是一个专业的会议记录助手。
    利用会话摘要来提供更好的上下文理解。
    """,
)

# 智能体会自动创建和更新会话摘要
agent.print_response("请记录我们的讨论要点。")
```

**章节来源**
- [09_agent_session.py](file://cookbook/getting_started/09_agent_session.py)

### 会话管理特性

- **会话摘要**：自动总结对话内容
- **历史检索**：快速访问过去的对话
- **会话恢复**：从之前的会话继续
- **多用户支持**：支持多个用户的独立会话

## 多智能体协作

多个智能体可以协同工作完成复杂任务。

### 智能体团队示例

```python
"""专业新闻与金融团队！"""

from textwrap import dedent
from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.team.team import Team
from agno.tools.duckduckgo import DuckDuckGoTools
from agno.tools.exa import ExaTools

# 创建网络研究员智能体
web_agent = Agent(
    name="网络研究员",
    role="在网络上搜索信息",
    model=OpenAIChat(id="gpt-4o"),
    tools=[DuckDuckGoTools()],
    instructions=dedent("""\
        你是一位经验丰富的网络研究员和新闻分析师！🔍

        搜索信息时遵循以下步骤：
        1. 从最新和最相关的来源开始
        2. 从多个来源交叉参考信息
        3. 优先考虑声誉良好的新闻机构和官方来源
        4. 始终引用带有链接的来源
        5. 重点关注市场驱动的新闻和重大发展

        你的风格指南：
        - 以清晰、新闻业风格呈现信息
        - 使用要点突出关键要点
        - 包含可用的引言
        - 为每条新闻指定日期和时间
        - 强调市场情绪和行业趋势
        - 以对整体叙述的简要分析结束
        - 特别关注监管新闻、财报和战略公告\
    """),
    markdown=True,
)

# 创建金融分析师智能体
finance_agent = Agent(
    name="金融分析师",
    role="获取金融数据",
    model=OpenAIChat(id="gpt-4o"),
    tools=[
        ExaTools(
            include_domains=["trendlyne.com"],
            text=False,
            highlights=False,
            show_results=True,
        )
    ],
    instructions=dedent("""\
        你是一位精通市场数据的熟练金融分析师！📊

        分析金融数据时遵循以下步骤：
        1. 从最新的股价、交易量和日范围开始
        2. 呈现详细的分析师推荐和共识目标价格
        3. 包括关键指标：市盈率、市值、52周范围
        4. 分析交易模式和成交量趋势
        5. 与相关行业指数进行比较

        你的风格指南：
        - 使用表格展示结构化数据
        - 为每个数据部分添加清晰的标题
        - 为技术术语添加简要解释
        - 使用表情符号（📈 📉）突出显著变化
        - 使用要点提供快速洞察
        - 将当前值与历史平均值进行比较
        - 以数据驱动的金融展望结束\
    """),
    markdown=True,
)

# 创建团队
agent_team = Team(
    members=[web_agent, finance_agent],
    model=OpenAIChat(id="gpt-4o"),
    instructions=dedent("""\
        你是著名金融新闻编辑部的首席编辑！📰

        你的角色：
        1. 在网络研究员和金融分析师之间进行协调
        2. 将他们的发现整合成引人入胜的叙述
        3. 确保所有信息都得到正确来源验证
        4. 提供新闻和数据的平衡观点
        5. 强调关键风险和机会

        你的风格指南：
        - 以引人注目的标题开头
        - 以强有力的执行摘要开始
        - 先呈现金融数据，然后是新闻背景
        - 使用清晰的分节区分不同类型的信息
        - 在可用时包含相关图表或表格
        - 添加"市场情绪"部分显示当前情绪
        - 以"关键要点"部分结束
        - 适当情况下包含"风险因素"
        - 以"市场观察团队"和当前日期结束\
    """),
    add_datetime_to_context=True,
    markdown=True,
    show_members_responses=False,
)

# 示例使用
agent_team.print_response(
    "总结 NVDA 的分析师推荐并分享最新新闻", stream=True
)
```

**章节来源**
- [17_agent_team.py](file://cookbook/getting_started/17_agent_team.py#L1-L133)

### 团队协作模式

- **协作模式**：所有成员共同参与决策
- **协调模式**：由领导智能体协调工作
- **路由模式**：根据任务类型分配给特定成员

## 高级功能

### 多媒体处理

智能体可以处理多种媒体类型。

#### 图像处理智能体

```python
"""图像分析智能体"""

from agno.agent import Agent
from agno.models.openai import OpenAIChat

agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions="你是一个专业的图像分析助手。",
)

# 处理图像文件
agent.print_response(
    "分析这张图片并描述其中的内容。",
    media=[Image(path="image.jpg")]
)
```

**章节来源**
- [13_image_agent.py](file://cookbook/getting_started/13_image_agent.py)

#### 视频生成智能体

```python
"""视频生成智能体"""

from agno.agent import Agent
from agno.models.models_lab import ModelsLab

agent = Agent(
    model=ModelsLab(),
    instructions="你是一个创意视频生成助手。",
)

# 生成视频
agent.print_response(
    "生成一个关于未来城市的创意视频概念。",
    media=[Video(generate=True)]
)
```

**章节来源**
- [15_generate_video.py](file://cookbook/getting_started/15_generate_video.py)

### 人类交互

智能体可以要求人工确认才能执行某些操作。

```python
"""带人工交互的智能体"""

from agno.agent import Agent
from agno.models.openai import OpenAIChat

agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    instructions="你是一个谨慎的财务顾问。",
    human_in_the_loop=True,  # 启用人工检查
)

# 智能体会在执行敏感操作前请求确认
agent.print_response("帮我执行一笔价值 $1000 的交易。")
```

**章节来源**
- [12_human_in_the_loop.py](file://cookbook/getting_started/12_human_in_the_loop.py)

### 研究智能体

```python
"""AI研究助手"""

from datetime import datetime
from pathlib import Path
from textwrap import dedent
from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.tools.exa import ExaTools

cwd = Path(__file__).parent.resolve()
tmp = cwd.joinpath("tmp")
if not tmp.exists():
    tmp.mkdir(exist_ok=True, parents=True)

today = datetime.now().strftime("%Y-%m-%d")

agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    tools=[ExaTools(start_published_date=today, type="keyword")],
    description=dedent("""\
        你是一个杰出的 AI 研究科学家，专长于分析和综合复杂信息。
        你的专长在于创建符合学术标准且引人入胜的研究报告。
    """),
    instructions=dedent("""\
        开始运行 3 个不同的搜索来收集全面的信息。
        分析和交叉参考来源以确保准确性和相关性。
        按照学术标准但保持可读性来组织你的报告。
        仅包含经过验证的事实并正确引用。
        创建引人入胜的叙述，引导读者了解复杂主题。
        以可操作的要点和未来影响结束。
    """),
    expected_output=dedent("""\
    以 markdown 格式的专业研究报告：

    # {捕捉主题精髓的引人注目的标题}

    ## 执行摘要
    {关键发现和重要性的简要概述}

    ## 引言
    {主题的背景和重要性}
    {当前研究/讨论的状态}

    ## 主要发现
    {主要发现或发展}
    {支持证据和分析}

    ## 影响
    {对领域/社会的影响}
    {未来方向}

    ## 关键要点
    - {要点 1}
    - {要点 2}
    - {要点 3}

    ## 参考文献
    - [来源 1](链接) - 关键发现/引言
    - [来源 2](链接) - 关键发现/引言
    - [来源 3](链接) - 关键发现/引言

    ---
    由教授 X-1000 生成
    高级研究系统部门
    日期：{当前日期}\
    """),
    markdown=True,
    add_datetime_to_context=True,
    save_response_to_file=str(tmp.joinpath("{message}.md")),
)

# 示例使用
agent.print_response(
    "研究脑机接口的最新发展", stream=True
)
```

**章节来源**
- [18_research_agent_exa.py](file://cookbook/getting_started/18_research_agent_exa.py#L1-L114)

## 故障排除

### 常见问题及解决方案

#### 1. API 密钥问题

```python
# 检查 API 密钥是否正确设置
import os

print("OpenAI API Key:", os.getenv("OPENAI_API_KEY"))
print("EXA API Key:", os.getenv("EXA_API_KEY"))
print("ModelsLab API Key:", os.getenv("MODELS_LAB_API_KEY"))
```

#### 2. 依赖包版本冲突

```bash
# 升级 pip 并重新安装
pip install --upgrade pip
pip install --force-reinstall agno
```

#### 3. 知识库初始化失败

```python
# 检查数据库路径和权限
import os

db_path = "tmp/lancedb"
os.makedirs(db_path, exist_ok=True)
print(f"数据库路径存在: {os.path.exists(db_path)}")
```

#### 4. 工具执行错误

```python
# 添加错误处理装饰器
import functools

def safe_tool(func):
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except Exception as e:
            return f"工具执行失败: {str(e)}"
    return wrapper

@safe_tool
def risky_tool():
    # 可能出错的工具代码
    pass
```

### 调试技巧

1. **启用调试日志**：
```python
from agno.utils.log import set_log_level_to_debug
set_log_level_to_debug()
```

2. **检查智能体状态**：
```python
print(f"智能体 ID: {agent.id}")
print(f"会话 ID: {agent.session_id}")
print(f"状态: {agent.session_state}")
```

3. **监控工具调用**：
```python
agent.print_response("测试工具调用", stream=True)
```

## 总结

通过本快速开始指南，您已经学会了：

1. **环境搭建**：成功安装和配置 Agno 环境
2. **基础智能体**：创建具有独特个性的简单智能体
3. **工具集成**：添加网络搜索和其他实用工具
4. **知识库**：集成向量数据库和 RAG 系统
5. **自定义工具**：开发自己的专用工具
6. **持久化存储**：实现会话和状态持久化
7. **多智能体协作**：构建团队智能体系统
8. **高级功能**：处理多媒体和人工交互

### 下一步建议

1. **探索更多示例**：浏览 cookbook 中的其他示例
2. **自定义配置**：根据您的具体需求调整智能体设置
3. **性能优化**：学习如何优化智能体的响应速度
4. **部署应用**：将智能体集成到实际的应用程序中
5. **社区贡献**：参与 Agno 社区，分享您的经验和工具

### 最佳实践总结

- **渐进式学习**：按照指南中的顺序逐步学习
- **错误处理**：始终为工具和 API 调用添加错误处理
- **安全考虑**：在生产环境中实施适当的安全措施
- **性能监控**：跟踪智能体的性能和资源使用情况
- **持续改进**：根据用户反馈不断优化智能体的行为

现在您已经掌握了 Agno 的基础知识，可以开始构建自己的智能体应用程序了！记住，最好的学习方式是通过实践，所以请大胆尝试并创新。